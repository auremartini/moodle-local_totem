{"version":3,"file":"get_ajax_totemtable.min.js","sources":["../src/get_ajax_totemtable.js"],"sourcesContent":["/**\n * @module    block_totem/slideshow\n * @package   blocktotem\n * @copyright 2020 Aureliano Martini\n * @licence   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since     3.0\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/notification'], function($, ajax, templates, notification) {\n    return {\n        load: function(date, offset, limit, skipweekend, logo, template) {\n            if (offset == limit) {\n                offset = 0;\n            }\n\n            if (offset == 0) {\n                date = parseInt(Date.now() / 1000);\n            }\n\n            switch (template) {\n                case 1:\n                    template = \"local_totem/totem_table_fullscreen_1\";\n                    break;\n                default:\n                    template = 'local_totem/totem_table_fullscreen';\n                }\n\n\n            var promises = ajax.call([\n                {\n                    methodname: 'local_totem_get_totemtable',\n                    args: {\n                        date: date,\n                        offset: offset,\n                        skipweekend: skipweekend,\n                        logo: logo\n                    }\n                }\n            ]);\n            promises[0].done(function(response) {\n                templates.render(template, response).done(function(html) {\n                    $('[data-region=\"totem_fullscreen\"]').replaceWith(html);\n\n                    var h = $('[data-region=\"totem_fullscreen\"]').height();\n                        h -= $('[data-region=\"totem_fullscreen-title\"]').height();\n                        h -= $('[data-region=\"totem_fullscreen-msg\"]').height();\n                    $('[data-region=\"totem_fullscreen-scroll\"]').css('height', h + 'px');\n                    $('[data-region=\"totem_fullscreen-scroll\"]').css('overflow', 'hidden');\n                    $('[data-region=\"totem_fullscreen-table\"]').removeClass('hidden');\n\n                    //SET SCROLL FUNCTION\n                    var speed = 2000;\n                    var scrollItemIndex = 0;\n                    var scrollTimeInterval = setInterval(function() {\n                        var row = $('[data-region=\"totem_fullscreen-table-row\"]');\n\n                        if (row.length > 0) {\n                            row[scrollItemIndex].scrollIntoView();\n                            scrollItemIndex++;\n                        }\n\n                        if (row.length == scrollItemIndex ) {\n                            clearTimeout(scrollTimeInterval);\n                            setTimeout(function() {\n                                //Show loading screen\n                                var loadingHTML =  '<p style=\"text-align: center\">';\n                                    loadingHTML += '<img src=\"pix/loading.gif\" alt=\"loading...\" width=\"16px\"></p>';\n                                $('[data-region=\"totem_fullscreen\"]').innerHTML = loadingHTML;\n\n                                //AJAX CALL\n                                require([\"local_totem/get_ajax_totemtable\"], function(totemtable) {\n                                    totemtable.load(date, offset+1, limit, skipweekend, logo);\n                                });\n                            }, speed);\n                        }\n                    }, speed);\n                }).fail(notification.exception);\n            }).fail(notification.exception);\n        }\n    };\n});"],"names":["define","$","ajax","templates","notification","load","date","offset","limit","skipweekend","logo","template","parseInt","Date","now","call","methodname","args","done","response","render","html","replaceWith","h","height","css","removeClass","scrollItemIndex","scrollTimeInterval","setInterval","row","length","scrollIntoView","clearTimeout","setTimeout","innerHTML","loadingHTML","require","totemtable","fail","exception"],"mappings":"AAQAA,yCAAO,CAAC,SAAU,YAAa,iBAAkB,sBAAsB,SAASC,EAAGC,KAAMC,UAAWC,oBACzF,CACHC,KAAM,SAASC,KAAMC,OAAQC,MAAOC,YAAaC,KAAMC,aAC/CJ,QAAUC,QACVD,OAAS,GAGC,GAAVA,SACAD,KAAOM,SAASC,KAAKC,MAAQ,MAIxB,IADDH,SAEAA,SAAW,4CAGXA,SAAW,qCAIJT,KAAKa,KAAK,CACrB,CACIC,WAAY,6BACZC,KAAM,CACFX,KAAMA,KACNC,OAAQA,OACRE,YAAaA,YACbC,KAAMA,SAIT,GAAGQ,MAAK,SAASC,UACtBhB,UAAUiB,OAAOT,SAAUQ,UAAUD,MAAK,SAASG,MAC/CpB,EAAE,oCAAoCqB,YAAYD,UAE9CE,EAAItB,EAAE,oCAAoCuB,SAC1CD,GAAKtB,EAAE,0CAA0CuB,SACjDD,GAAKtB,EAAE,wCAAwCuB,SACnDvB,EAAE,2CAA2CwB,IAAI,SAAUF,EAAI,MAC/DtB,EAAE,2CAA2CwB,IAAI,WAAY,UAC7DxB,EAAE,0CAA0CyB,YAAY,cAIpDC,gBAAkB,EAClBC,mBAAqBC,aAAY,eAC7BC,IAAM7B,EAAE,8CAER6B,IAAIC,OAAS,IACbD,IAAIH,iBAAiBK,iBACrBL,mBAGAG,IAAIC,QAAUJ,kBACdM,aAAaL,oBACbM,YAAW,WAIPjC,EAAE,oCAAoCkC,UADlCC,8FAIJC,QAAQ,CAAC,oCAAoC,SAASC,YAClDA,WAAWjC,KAAKC,KAAMC,OAAO,EAAGC,MAAOC,YAAaC,WApBxD,QAAA,QAyBb6B,KAAKnC,aAAaoC,cACtBD,KAAKnC,aAAaoC"}