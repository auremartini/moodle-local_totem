{"version":3,"file":"event_edit_form_dynamics.min.js","sources":["../src/event_edit_form_dynamics.js"],"sourcesContent":["/**\n * Local plugin \"Totem: show teacher's attendences and event totem\" - Version file\n *\n * @package    local_totem\n * @copyright  2022, Aureliano Martini (Liceo cantonale di Lugano 2) <aureliano.martini@edu.ti.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function() {\n    return {\n        init: function(params) {\n            // Event type list\n            document.getElementById('id_eventtypelist').innerHTML = \"\";\n            var option = document.createElement(\"option\");\n            option.value = '';\n            option.text = '';\n            document.getElementById('id_eventtypelist').add(option);\n\n            var list = params.eventtypelist.split('\\n');\n            list.forEach(function(item) {\n                var params = item.split('|');\n                var option = document.createElement(\"option\");\n                option.value = params[0];\n                option.text = params[1];\n                option.style = params[2];\n                document.getElementById('id_eventtypelist').add(option);\n            });\n\n            document.getElementById('id_eventtypelist').addEventListener('change', function() {\n                document.getElementsByName('eventtype')[0].value = document.getElementById(\"id_eventtypelist\").value;\n            });\n\n            if (document.getElementsByName('eventtype')[0].value != '') {\n                var element = document.getElementById(\"id_eventtypelist\");\n                element.value = document.getElementsByName('eventtype')[0].value;\n                element.dispatchEvent(new Event('change'));\n            }\n\n            // Teacher list\n            require(['jquery', 'core/ajax', 'core/notification'], function($, ajax, notification) {\n                var promises = ajax.call([\n                    {\n                        methodname: 'local_totem_get_userlist',\n                        args: { source: parseInt(params.source + \"\"), sourceid: parseInt(params.sourceid + \"\") }\n                    }\n                ]);\n                promises[0].done(function(response) {\n                    document.getElementById('id_useridlist').innerHTML = \"\";\n                    var option = document.createElement(\"option\");\n                    option.value = '';\n                    option.text = '';\n                    document.getElementById('id_useridlist').add(option);\n                    response.forEach(function(item) {\n                        var option = document.createElement(\"option\");\n                        option.value = item.id;\n                        option.text = item.lastname + \" \" + item.firstname;\n                        document.getElementById('id_useridlist').add(option);\n                    });\n                    document.getElementById('id_useridlist').addEventListener('change', function() {\n                        document.getElementsByName('userid')[0].value = document.getElementById(\"id_useridlist\").value;\n                        if (document.getElementsByName('teaching')[0].value != '') {\n                            document.getElementsByName('teaching')[0].value = '-';\n                        }\n                        var promises2 = ajax.call([\n                            {\n                                methodname: 'local_totem_get_teachinglist',\n                                args: {\n                                    blockteachings: String(params.blockteachings),\n                                    teacherid: parseInt(document.getElementById(\"id_useridlist\").value + '')\n                                }\n                            }\n                        ]);\n                        promises2[0].done(function(response2) {\n                            document.getElementById('id_teachinglist').innerHTML = \"\";\n                            var option = document.createElement(\"option\");\n                            option.value = '';\n                            option.text = '';\n                            document.getElementById('id_teachinglist').add(option);\n                            response2.forEach(function(item) {\n                                var option = document.createElement(\"option\");\n                                option.value = item.id;\n                                option.text = item.name;\n                                document.getElementById('id_teachinglist').add(option);\n                            });\n                            if (document.getElementsByName('id')[0].value == '0') {\n                                if (response2.length > 0) {\n                                    document.getElementsByName('teaching')[0].value = response2[0].id;\n                                    document.getElementById(\"id_teachinglist\").value = response2[0].id;\n                                }\n                            } else {\n                                var d = document.getElementById(\"id_teachinglist\");\n                                if (document.getElementsByName('teaching')[0].value == '') {\n                                    d.value = document.getElementsByName('teaching')[0].value;\n                                } else {\n                                    d.value = document.getElementsByName('teaching')[0].value;\n                                    if (document.getElementById(\"id_teachinglist\").value == '') {\n                                        document.getElementsByName('teaching')[0].value = response2[0].id;\n                                        document.getElementById(\"id_teachinglist\").value = response2[0].id;\n                                    }\n                                }\n                            }\n                            document.getElementById('id_teachinglist').addEventListener('change', function() {\n                                document.getElementsByName('teaching')[0].value = document.getElementById(\"id_teachinglist\").value;\n                            }, false);\n                        }).fail(notification.exception);\n                    }, false);\n                    if (document.getElementsByName('userid')[0].value != '') {\n                        var element = document.getElementById(\"id_useridlist\");\n                        element.value = document.getElementsByName('userid')[0].value;\n                        element.dispatchEvent(new Event('change'));\n                    }\n                }).fail(notification.exception);\n             });\n\n            // Timetable: timestart\n            document.getElementById('id_timestartlist').innerHTML = \"\";\n            var option = document.createElement(\"option\");\n            option.value = '0';\n            option.text = '';\n            document.getElementById('id_timestartlist').add(option);\n\n            var list = params.timetable.split('\\n');\n            list.forEach(function(item) {\n                var val = item.split('|');\n                var option = document.createElement(\"option\");\n                option.value = val[0];\n                option.text = (params.inputimes == '1' ? val[1] : val[0]);\n                document.getElementById('id_timestartlist').add(option);\n            });\n\n            document.getElementById('id_timestartlist').addEventListener('change', function() {\n                document.getElementsByName('timestart')[0].value = document.getElementById('id_timestartlist').value;\n            });\n\n            if (document.getElementsByName('timestart')[0].value != '') {\n                var element = document.getElementById('id_timestartlist');\n                element.value = document.getElementsByName('timestart')[0].value;\n                element.dispatchEvent(new Event('change'));\n            }\n\n            document.getElementById('id_timestartlist').addEventListener('change', function() {\n                var tstart = document.getElementById('id_timestartlist');\n                var tend = document.getElementById('id_timeendlist');\n                for (var i = 0; i < tend.options.length; i++) {\n                    if (i == 0) {\n                        tend.options[i].style = \"\";\n                    } else if (i < tstart.value) {\n                        tend.options[i].style = \"display: none\";\n                    } else {\n                        tend.options[i].style = \"\";\n                    }\n                }\n                if (tend.value <= tstart.value) {\n                    tend.value = parseInt(tstart.value);\n                    tend.dispatchEvent(new Event('change'));\n                }\n            }, false);\n\n            // Timetable: timeend\n            document.getElementById('id_timeendlist').innerHTML = \"\";\n            var option = document.createElement(\"option\");\n            option.value = '';\n            option.text = '';\n            document.getElementById('id_timeendlist').add(option);\n\n            var list = params.timetable.split('\\n');\n            list.forEach(function(item) {\n                var val = item.split('|');\n                var option = document.createElement(\"option\");\n                option.value = val[0];\n                option.text = (params.inputimes == '1' ? val[2] : val[0]);\n                document.getElementById('id_timeendlist').add(option);\n            });\n\n            document.getElementById('id_timeendlist').addEventListener('change', function() {\n                document.getElementsByName('timeend')[0].value = document.getElementById(\"id_timeendlist\").value;\n            });\n\n            if (document.getElementsByName('timeend')[0].value != '') {\n                var element = document.getElementById(\"id_timeendlist\");\n                element.value = document.getElementsByName('timeend')[0].value;\n                element.dispatchEvent(new Event('change'));\n            }\n\n            // Trigger Timetable timestart event\n            document.getElementById('id_timestartlist').dispatchEvent(new Event('change'));\n\n            // Message templates\n            document.getElementById('id_displaytexttemplatelist').innerHTML = \"\";\n            var option = document.createElement(\"option\");\n            option.value = '';\n            option.text = '';\n            document.getElementById('id_displaytexttemplatelist').add(option);\n\n            var list = params.msgtemplates.split('\\r\\n');\n            list.forEach(function(item) {\n                var option = document.createElement(\"option\");\n                option.value = item;\n                option.text = item;\n                document.getElementById('id_displaytexttemplatelist').add(option);\n                if (document.getElementById('id_displaytext').value.substring(0, item.length).valueOf() == item.valueOf()) {\n                    document.getElementById('id_displaytext').value =\n                        document.getElementById('id_displaytext').value.slice(item.length);\n                    document.getElementById('id_displaytexttemplatelist').value = item;\n                }\n            });\n\n            document.getElementById('id_displaytexttemplatelist').addEventListener('change', function() {\n                document.getElementsByName('displaytexttemplate')[0].value =\n                    document.getElementById('id_displaytexttemplatelist').value;\n            });\n        }\n    };\n});"],"names":["define","init","params","element","option","document","getElementById","innerHTML","createElement","value","text","add","eventtypelist","split","forEach","item","style","addEventListener","getElementsByName","dispatchEvent","Event","require","$","ajax","notification","call","methodname","args","source","parseInt","sourceid","done","response","id","lastname","firstname","blockteachings","String","teacherid","response2","name","length","d","fail","exception","timetable","val","inputimes","tstart","tend","i","options","msgtemplates","substring","valueOf","slice"],"mappings":"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"}