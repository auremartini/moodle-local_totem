{"version":3,"file":"event_edit_form_dynamics.min.js","sources":["../src/event_edit_form_dynamics.js"],"sourcesContent":["/**\n * Local plugin \"Totem: show teacher's attendences and event totem\" - Version file\n *\n * @package    local_totem\n * @copyright  2022, Aureliano Martini (Liceo cantonale di Lugano 2) <aureliano.martini@edu.ti.ch>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery'], function() {\n    return {\n        init: function(params) {\n            // Event type list\n            document.getElementById('id_eventtypelist').innerHTML = \"\";\n            var option = document.createElement(\"option\");\n            option.value = '';\n            option.text = '';\n            document.getElementById('id_eventtypelist').add(option);\n\n            var list = params.eventtypelist.split('\\n');\n            list.forEach(function(item) {\n                var params = item.split('|');\n                var option = document.createElement(\"option\");\n                option.value = params[0];\n                option.text = params[1];\n                option.style = params[2];\n                document.getElementById('id_eventtypelist').add(option);\n            });\n\n            document.getElementById('id_eventtypelist').addEventListener('change', function() {\n                document.getElementsByName('eventtype')[0].value = document.getElementById(\"id_eventtypelist\").value;\n            });\n\n            if (document.getElementsByName('eventtype')[0].value != '') {\n                var element = document.getElementById(\"id_eventtypelist\");\n                element.value = document.getElementsByName('eventtype')[0].value;\n                element.dispatchEvent(new Event('change'));\n            }\n\n            // Teacher list\n            require(['jquery', 'core/ajax', 'core/notification'], function($, ajax, notification) {\n                var promises = ajax.call([\n                    {\n                        methodname: 'local_totem_get_userlist',\n                        args: { source: parseInt(params.source + \"\"), sourceid: parseInt(params.sourceid + \"\") }\n                    }\n                ]);\n                promises[0].done(function(response) {\n                    document.getElementById('id_useridlist').innerHTML = \"\";\n                    var option = document.createElement(\"option\");\n                    option.value = '';\n                    option.text = '';\n                    document.getElementById('id_useridlist').add(option);\n                    response.forEach(function(item) {\n                        var option = document.createElement(\"option\");\n                        option.value = item.id;\n                        option.text = item.lastname + \" \" + item.firstname;\n                        document.getElementById('id_useridlist').add(option);\n                    });\n                    document.getElementById('id_useridlist').addEventListener('change', function() {\n                        document.getElementsByName('userid')[0].value = document.getElementById(\"id_useridlist\").value;\n                        if (document.getElementsByName('teaching')[0].value != '') {\n                            document.getElementsByName('teaching')[0].value = '-';\n                        }\n                        var promises2 = ajax.call([\n                            {\n                                methodname: 'local_totem_get_teachinglist',\n                                args: {\n                                    blockteachings: String(params.blockteachings),\n                                    teacherid: parseInt(document.getElementById(\"id_useridlist\").value + '')\n                                }\n                            }\n                        ]);\n                        promises2[0].done(function(response2) {\n                            document.getElementById('id_teachinglist').innerHTML = \"\";\n                            var option = document.createElement(\"option\");\n                            option.value = '';\n                            option.text = '';\n                            document.getElementById('id_teachinglist').add(option);\n                            response2.forEach(function(item) {\n                                var option = document.createElement(\"option\");\n                                option.value = item.id;\n                                option.text = item.name;\n                                document.getElementById('id_teachinglist').add(option);\n                            });\n                            if (document.getElementsByName('id')[0].value == '0') {\n                                if (response2.length > 0) {\n                                    document.getElementsByName('teaching')[0].value = response2[0].id;\n                                    document.getElementById(\"id_teachinglist\").value = response2[0].id;\n                                }\n                            } else {\n                                var d = document.getElementById(\"id_teachinglist\");\n                                if (document.getElementsByName('teaching')[0].value == '') {\n                                    d.value = document.getElementsByName('teaching')[0].value;\n                                } else {\n                                    d.value = document.getElementsByName('teaching')[0].value;\n                                    if (document.getElementById(\"id_teachinglist\").value == '') {\n                                        document.getElementsByName('teaching')[0].value = response2[0].id;\n                                        document.getElementById(\"id_teachinglist\").value = response2[0].id;\n                                    }\n                                }\n                            }\n                            document.getElementById('id_teachinglist').addEventListener('change', function() {\n                                document.getElementsByName('teaching')[0].value = document.getElementById(\"id_teachinglist\").value;\n                            }, false);\n                        }).fail(notification.exception);\n                    }, false);\n                    if (document.getElementsByName('userid')[0].value != '') {\n                        var element = document.getElementById(\"id_useridlist\");\n                        element.value = document.getElementsByName('userid')[0].value;\n                        element.dispatchEvent(new Event('change'));\n                    }\n                }).fail(notification.exception);\n             });\n\n            // Timetable: timestart\n            document.getElementById('id_timestartlist').innerHTML = \"\";\n            var option = document.createElement(\"option\");\n            option.value = '';\n            option.text = '';\n            document.getElementById('id_timestartlist').add(option);\n\n            var list = params.timetable.split('\\n');\n            list.forEach(function(item) {\n                var params = item.split('|');\n                var option = document.createElement(\"option\");\n                option.value = params[0];\n                option.text = params[1];\n                document.getElementById('id_timestartlist').add(option);\n            });\n\n            document.getElementById('id_timestartlist').addEventListener('change', function() {\n                document.getElementsByName('timestart')[0].value = document.getElementById('id_timestartlist').value;\n            });\n\n            if (document.getElementsByName('timestart')[0].value != '') {\n                var element = document.getElementById('id_timestartlist');\n                element.value = document.getElementsByName('timestart')[0].value;\n                element.dispatchEvent(new Event('change'));\n            }\n\n            document.getElementById('id_timestartlist').addEventListener('change', function() {\n                var tstart = document.getElementById('id_timestartlist');\n                var tend = document.getElementById('id_timeendlist');\n                for (var i = 0; i < tend.options.length; i++) {\n                    if (i == 0) {\n                        tend.options[i].style = \"\";\n                    } else if (i < tstart.value) {\n                        tend.options[i].style = \"display: none\";\n                    } else {\n                        tend.options[i].style = \"\";\n                    }\n                }\n                if (tend.value <= tstart.value) {\n                    tend.value = parseInt(tstart.value);\n                    tend.dispatchEvent(new Event('change'));\n                }\n            }, false);\n\n            // Timetable: timeend\n            document.getElementById('id_timeendlist').innerHTML = \"\";\n            var option = document.createElement(\"option\");\n            option.value = '';\n            option.text = '';\n            document.getElementById('id_timeendlist').add(option);\n\n            var list = params.timetable.split('\\n');\n            list.forEach(function(item) {\n                var params = item.split('|');\n                var option = document.createElement(\"option\");\n                option.value = params[0];\n                option.text = params[2];\n                document.getElementById('id_timeendlist').add(option);\n            });\n\n            document.getElementById('id_timeendlist').addEventListener('change', function() {\n                document.getElementsByName('timeend')[0].value = document.getElementById(\"id_timeendlist\").value;\n            });\n\n            if (document.getElementsByName('timeend')[0].value != '') {\n                var element = document.getElementById(\"id_timeendlist\");\n                element.value = document.getElementsByName('timeend')[0].value;\n                element.dispatchEvent(new Event('change'));\n            }\n\n            // Trigger Timetable timestart event\n            document.getElementById('id_timestartlist').dispatchEvent(new Event('change'));\n        }\n    };\n});"],"names":["define","init","params","option","element","document","getElementById","innerHTML","createElement","value","text","add","eventtypelist","split","forEach","item","style","addEventListener","getElementsByName","dispatchEvent","Event","require","$","ajax","notification","call","methodname","args","source","parseInt","sourceid","done","response","id","lastname","firstname","blockteachings","String","teacherid","response2","name","length","d","fail","exception","timetable","tstart","tend","i","options"],"mappings":"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"}